$(function(){function e(e){return $(e).addClass(t).prop("disabled",!0)}function r(e){$("#error-container").html(e).show()}var a=$("#uploaderFile"),o=$("#saveBtn"),t="avatar-btn-disabled";Array.prototype.indexOf||(Array.prototype.indexOf=function(e,r){for(var a=r||0,o=this.length;a<o;a++)if(this[a]===e)return a;return-1}),a.prop("disabled",!1),a.change(function(){["jpg","png","bmp"].indexOf(this.value.split(".").pop().toLowerCase())>-1?($("#uploadForm").submit(),e(a)):r("图片格式只支持jpg/png/bmp")}),$("#cropper-image").cropper({zoomable:!1,viewMode:3,aspectRatio:1,minContainerWidth:120,preview:"#previewContainer",crop:function(e){$.each(["x","y","width","height"],function(r,a){$("#cropper-"+a).val(parseInt(e[a],10))})},built:function(){o.prop("disabled",!1).removeClass(t).addClass("avatar-save")}}),o.on("click",function(r){r.preventDefault(),e(this).removeClass("avatar-save"),e(a),$.post("/profile/picture/crop",$("#cropForm").serialize(),"json").always(function(e){e.success?location.assign("/User/AssetOverview"):location.assign("/User/SetAvatar")})})});